This is the code for a more advanced HMM model.
